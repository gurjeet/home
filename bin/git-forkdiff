#!/bin/bash

# File name: git-forkdiff
#
# Place it in your $PATH
#
# Usage:
#  git forkdiff [git-diff-options] <forked from branch/commit> <forked branch/commit>
#
# Example:
#    git forkdiff --stat origin/master my_forked_branch
#
# It takes the last 2 parameters and performs git-merge-base to determine the
# fork-point (the commit that is common to the two branches/commits), and then
# issues a git-diff between that fork-point and the last parameter.
#
# It passes the rest of the parameters (all except the last two) to the git-diff
# as is. So you can use this function to see the stats too, like so:
#
#    git forkdiff --stat origin/master my_forked_branch
#
# I tried to embed this command as alias.fork-diff in ~/.gitconfig, but it
# didn't work.
#
# [alias]
#     fork-diff = !bash -c 'git diff ${@: 1:$(($# - 2))} $(git merge-base ${@: -2:1} ${@: -1:1}) ${@: -1:1}' -
#
# The problem seems to be that there's a # character in the string above and
# that seems to terminate the command midway through.

git diff ${@: 1:$(($# - 2))} $(git merge-base ${@: -2:1} ${@: -1:1}) ${@: -1:1}
